<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title><%= title %></title>
  <link rel="stylesheet" href="/stylesheets/style.css" />
  <style>
    body { font-family: Arial; background: #f9f9f9; padding: 2rem; }
    header { display: flex; justify-content: space-between; align-items: center; }
    h2 { color: #e2e2e2; }
    form { margin-bottom: 1.5rem; }
    ul { list-style: none; padding: 0; }
    li { background: #fff; margin: .5rem 0; padding: .5rem; border-radius: 5px; box-shadow: 0 1px 3px rgba(0,0,0,.1); }
    .pagination a { margin-right: 1rem; }
  </style>
  <script>
    function confirmDelete(name) {
      return confirm(`¿Seguro que deseas borrar el producto "${name}"?`);
    }
  </script>
</head>
<body>
  <header>
    <h2>Nodepop</h2>
    <% if (user) { %>
      <p>Bienvenido <%= user %> | <a href="/logout">Cerrar sesión</a></p>
    <% } else { %>
      <a href="/login">Login</a>
    <% } %>
  </header>

  <main>
    <h1>Mis productos</h1>

    <form method="get" action="/">
      <input type="text" name="name" placeholder="Buscar producto..." value="<%= query.name || '' %>">
      <select name="tag">
        <option value="">Todos</option>
        <option value="work" <%= query.tag === 'work' ? 'selected' : '' %>>Work</option>
        <option value="lifestyle" <%= query.tag === 'lifestyle' ? 'selected' : '' %>>Lifestyle</option>
        <option value="motor" <%= query.tag === 'motor' ? 'selected' : '' %>>Motor</option>
        <option value="mobile" <%= query.tag === 'mobile' ? 'selected' : '' %>>Mobile</option>
      </select>
      <input type="number" name="min" placeholder="Precio mínimo" value="<%= query.min || '' %>">
      <input type="number" name="max" placeholder="Precio máximo" value="<%= query.max || '' %>">
      <button type="submit">Filtrar</button>
    </form>

    <p>Total: <%= total %> producto(s)</p>

    <ul>
      <% if (products.length === 0) { %>
        <li>No hay productos</li>
      <% } else { %>
        <% products.forEach(p => { %>
          <li>
            <strong><%= p.name %></strong> — <%= p.price %>€
            [<%= p.tags.join(', ') %>]
            <form method="post" action="/delete/<%= p._id %>" style="display:inline;" onsubmit="return confirmDelete('<%= p.name %>')">
              <button type="submit">Borrar</button>
            </form>
          </li>
        <% }) %>
      <% } %>
    </ul>

    <div class="pagination">
      <% if (prevSkip !== null) { %>
        <a href="/?skip=<%= prevSkip %>&limit=<%= limit %>
          <% if (query.tag) { %>&tag=<%= query.tag %><% } %>
          <% if (query.name) { %>&name=<%= query.name %><% } %>
          <% if (query.min) { %>&min=<%= query.min %><% } %>
          <% if (query.max) { %>&max=<%= query.max %><% } %>">Anterior</a>
      <% } %>

      <% if (nextSkip !== null) { %>
        <a href="/?skip=<%= nextSkip %>&limit=<%= limit %>
          <% if (query.tag) { %>&tag=<%= query.tag %><% } %>
          <% if (query.name) { %>&name=<%= query.name %><% } %>
          <% if (query.min) { %>&min=<%= query.min %><% } %>
          <% if (query.max) { %>&max=<%= query.max %><% } %>">Siguiente</a>
      <% } %>
    </div>

    <% if (user) { %>
      <hr>
      <h1>Crear nuevo producto</h1>
      <form method="post" action="/">
        <input type="text" name="name" placeholder="Nombre" required>
        <input type="number" name="price" placeholder="Precio" required>
        <input type="text" name="tags" placeholder="Tags (ej: work, mobile)">
        <button type="submit">Crear</button>
      </form>
    <% } %>
  </main>
</body>
</html>
